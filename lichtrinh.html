<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n l√Ω l·ªãch tr√¨nh</title>

<style>
    body {
        font-family: Arial;
        background: #6deb93;
        padding: 20px;
    }
    .container {
        width: 90%;
        background: rgb(238, 221, 190);
        padding: 20px;
        margin: auto;
        border-radius: 10px;
        box-shadow: 0 0 10px #0002;
    }
    input, button {
        padding: 8px;
        margin: 6px 0;
        width: 100%;
    }

    /* Thanh tr√™n */
    #topbar {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        background: #6064a7;
        padding: 10px;
        border-radius: 10px;
        font-weight: bold;
        color: bisque;
    }
    #dangxuat {
        background: red;
        color: white;
        width: auto;
        padding: 5px 12px;
        border-radius: 5px;
        cursor: pointer;
    }

    #thuHienTai {
        font-weight: bold;
        margin-bottom: 10px;
        color: #333;
    }
    .lich-item {
        background: #f0f0f0;
        padding: 8px;
        margin: 6px 0;
        border-radius: 5px;
    }
    .btn-small {
        padding: 5px 10px;
        width: auto;
        margin-right: 5px;
    }

    /* Popup s·ª≠a */
    #popupSua {
        display:none;
        position: fixed;
        top: 0;
        left: 0;
        right:0;
        bottom:0;
        background: rgba(0,0,0,0.4);
        justify-content: center;
        align-items: center;
    }
    #khungSua {
        background: white;
        padding: 20px;
        width: 350px;
        border-radius: 10px;
    }

    /* ======= N·ªÄN & CH·ªÆ TO CHO PH·∫¶N 7 NG√ÄY ======= */
    .ngay7 {
        background: rgba(255, 255, 255, 0.9);
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 10px;
        font-size: 18px;
        line-height: 1.5;
    }
    .lich7 {
        background: #f9f2c8;
        padding: 6px 10px;
        margin: 5px 0;
        border-radius: 6px;
        font-size: 17px;
    }
</style>
</head>
<body>

<div class="container">

    <!-- Thanh t√™n + ƒëƒÉng xu·∫•t -->
    <div id="topbar">
        <span id="ten_hien_thi">T√†i kho·∫£n: ...</span>
        <button id="dangxuat">ƒêƒÉng xu·∫•t</button>
    </div>

    <div style="width: 50px;background-color: black;padding: 5px; border-radius: 10px;">
        <a href="trangchu.html"><img src="ngoinha.jpg" width="100%" style="border-radius: 10px;"></a>
        <a href="tienichmorong.html"><img src="muiten.jpg" width="100%" style="border-radius: 10px; margin-top: 20px;"></a>
    </div>

    <h2>Qu·∫£n l√Ω l·ªãch tr√¨nh</h2>

    <label>Ch·ªçn ng√†y:</label>
    <input type="date" id="chonNgay">

    <div id="thuHienTai"></div>

    <div id="formNhap" style="display:none;">
        <label>Gi·ªù:</label>
        <input type="time" id="gio">

        <label>N·ªôi dung:</label>
        <input type="text" id="noidung">

        <button onclick="luuLichTrinh()" style="background-color: #f1e497;color: rgb(18, 18, 20);">L∆∞u l·ªãch tr√¨nh</button>
    </div>

    <h3>L·ªãch trong ng√†y</h3>
    <div id="lichTrongNgay"></div>

    <hr>

    <button onclick="xem7Ngay()" style="background-color: #aad6f0;">Xem l·ªãch tr√¨nh 7 ng√†y t·ªõi</button>
    <div id="ketQua" style="margin-top:20px;"></div>
</div>

<!-- Popup s·ª≠a l·ªãch -->
<div id="popupSua">
    <div id="khungSua">
        <h3>S·ª≠a l·ªãch tr√¨nh</h3>

        <label>Gi·ªù:</label>
        <input type="time" id="editGio">

        <label>N·ªôi dung:</label>
        <input type="text" id="editNoiDung">

        <button onclick="capNhatLich()">C·∫≠p nh·∫≠t</button>
        <button onclick="dongPopup()">H·ªßy</button>
    </div>
</div>

<script>
// =============================
//   KI·ªÇM TRA ƒêƒÇNG NH·∫¨P
// =============================
let user = localStorage.getItem("dangnhap_hien_tai");

if (!user) {
    alert("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!");
    window.location.href = "dangnhap.html";
}

// Hi·ªán t√™n ng∆∞·ªùi d√πng
document.getElementById("ten_hien_thi").innerText = "T√†i kho·∫£n: " + user;

// N√∫t ƒëƒÉng xu·∫•t
document.getElementById("dangxuat").addEventListener("click", () => {
    localStorage.removeItem("dangnhap_hien_tai");
    alert("ƒê√£ ƒëƒÉng xu·∫•t!");
    window.location.href = "trangchu.html";
});

// =============================
//   H√†m ƒë·ªïi ng√†y sang TH·ª®
// =============================
function layThu(dateStr) {
    let d = new Date(dateStr);
    let thu = d.getDay();
    const tenThu = ["Ch·ªß nh·∫≠t","Th·ª© 2","Th·ª© 3","Th·ª© 4","Th·ª© 5","Th·ª© 6","Th·ª© 7"];
    return tenThu[thu];
}

// =============================
//   Khi ch·ªçn ng√†y
// =============================
document.getElementById("chonNgay").addEventListener("change", function() {
    let ngay = this.value;
    if (ngay) {
        document.getElementById("thuHienTai").innerText = "üìÖ " + layThu(ngay);
        document.getElementById("formNhap").style.display = "block";
        hienLichTrongNgay();
    }
});

// =============================
//   L∆∞u l·ªãch v√†o LocalStorage
// =============================
function luuLichTrinh() {
    let ngay = document.getElementById("chonNgay").value;
    let gio = document.getElementById("gio").value;
    let noidung = document.getElementById("noidung").value;

    if (!ngay || !gio || !noidung) {
        alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!");
        return;
    }

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    ds.push({ user, ngay, gio, noidung });

    localStorage.setItem("lichtrinh", JSON.stringify(ds));

    alert("ƒê√£ l∆∞u!");
    document.getElementById("gio").value = "";
    document.getElementById("noidung").value = "";

    hienLichTrongNgay();
}

// =============================
//   Hi·ªán l·ªãch trong ng√†y
// =============================
let idDangSua = -1;

function hienLichTrongNgay() {
    let ngay = document.getElementById("chonNgay").value;
    let lichDiv = document.getElementById("lichTrongNgay");

    if (!ngay) return;

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    let lich = ds.filter((l, index) => {
        l.index = index;
        return l.user === user && l.ngay === ngay;
    });

    lichDiv.innerHTML = "";

    if (lich.length === 0) {
        lichDiv.innerHTML = "<i>Kh√¥ng c√≥ l·ªãch</i>";
        return;
    }

    lich.forEach(item => {
        lichDiv.innerHTML += `
            <div class="lich-item">
                <b>${item.gio}</b> ‚Äî ${item.noidung}<br>
                <button class="btn-small" onclick="moPopupSua(${item.index})">S·ª≠a</button>
                <button class="btn-small" onclick="xoaLich(${item.index})">X√≥a</button>
            </div>
        `;
    });
}

// =============================
//   X√≥a l·ªãch
// =============================
function xoaLich(idx) {
    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");
    ds.splice(idx, 1);
    localStorage.setItem("lichtrinh", JSON.stringify(ds));

    hienLichTrongNgay();
    alert("ƒê√£ x√≥a!");
}

// =============================
//   Popup s·ª≠a l·ªãch
// =============================
function moPopupSua(idx) {
    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");
    let item = ds[idx];

    idDangSua = idx;

    document.getElementById("editGio").value = item.gio;
    document.getElementById("editNoiDung").value = item.noidung;

    document.getElementById("popupSua").style.display = "flex";
}

function dongPopup() {
    document.getElementById("popupSua").style.display = "none";
}

// =============================
//   C·∫≠p nh·∫≠t l·ªãch
// =============================
function capNhatLich() {
    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");

    ds[idDangSua].gio = document.getElementById("editGio").value;
    ds[idDangSua].noidung = document.getElementById("editNoiDung").value;

    localStorage.setItem("lichtrinh", JSON.stringify(ds));

    alert("ƒê√£ c·∫≠p nh·∫≠t!");
    dongPopup();
    hienLichTrongNgay();
}

// =============================
//  Xem 7 ng√†y t·ªõi (ƒë√£ th√™m n·ªÅn + ch·ªØ to)
// =============================
function xem7Ngay() {
    let ketQua = document.getElementById("ketQua");
    ketQua.innerHTML = "";

    let ds = JSON.parse(localStorage.getItem("lichtrinh") || "[]");
    let html = "<h3>L·ªãch 7 ng√†y t·ªõi:</h3>";

    let today = new Date();

    for (let i = 0; i < 7; i++) {
        let d = new Date();
        d.setDate(today.getDate() + i);

        let ngayISO = d.toISOString().split("T")[0];
        let thu = layThu(ngayISO);

        html += `<div class="ngay7"><b>${ngayISO} (${thu})</b><br>`;

        let list = ds.filter(item => item.user === user && item.ngay === ngayISO);

        if (list.length === 0) {
            html += "<i>Kh√¥ng c√≥ l·ªãch</i></div>";
        } else {
            list.forEach(item => {
                html += `<div class="lich7">‚è∞ ${item.gio} ‚Äî ${item.noidung}</div>`;
            });
            html += "</div>";
        }

        html += "<br>";
    }

    ketQua.innerHTML = html;
}
</script>

</body>
</html>
