<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý chi tiêu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(120deg,#ffecd2,#fcb69f);
        }

        .header {
            background: rgba(0,0,0,0.75);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-box { font-size: 18px; }
        .logout {
            background: #ff4444;
            padding: 6px 12px;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        h2 { text-align: center; margin-top: 20px; }

        .calendar {
            text-align: center;
            margin-bottom: 20px;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .form-box {
            background: white;
            padding: 20px;
            width: 350px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.4);
        }

        label { font-weight: bold; }
        input {
            width: 100%;
            padding: 7px;
            margin: 6px 0 15px;
        }
        button {
            padding: 8px 15px;
            cursor: pointer;
        }

        #records {
            margin: 20px auto;
            width: 90%;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }
        td, th {
            padding: 8px;
            border: 1px solid #ccc;
            text-align: center;
        }

    </style>
</head>
<body>

    <!-- HEADER CÓ TÀI KHOẢN -->
    <div class="header">
        <div class="user-box">Xin chào, <span id="ten_user"></span></div>
        <button class="logout" onclick="dangXuat()">Đăng xuất</button>
    </div>

    <h2>Quản Lý Chi Tiêu</h2>

    <div class="calendar">
        <label><b style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">Chọn ngày:</b></label>
        <input type="date" id="datePicker" style="width: 80%;">
        <button onclick="openForm()">Thêm</button>
    </div>

    <!-- LỚP PHỦ TOÀN MÀN HÌNH -->
    <div class="overlay" id="overlay">
        <div class="form-box">
            <h3>Thêm Chi Tiêu</h3>
            <label>Sản phẩm:</label>
            <input type="text" id="sp">

            <label>Giá thành:</label>
            <input type="number" id="gia">

            <label>Số lượng:</label>
            <input type="number" id="soluong">

            <button onclick="addExpense()">Xác nhận</button>
            <button onclick="closeForm()" style="background:red;color:white">Đóng</button>
        </div>
    </div>

    <div id="records">
        <h3>Chi tiêu trong ngày</h3>
        <table>
            <thead>
                <tr>
                    <th>Sản phẩm</th>
                    <th>Giá</th>
                    <th>Số lượng</th>
                    <th>Tổng tiền</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <h3 style="text-align:right; margin-top:10px">Tổng: <span id="tong"></span> VNĐ</h3>
    </div>

    <script>

        // KIỂM TRA ĐĂNG NHẬP
        const user = localStorage.getItem("dangnhap_hien_tai");
        if (!user) {
            window.location.href = "dangnhap.html";
        } else {
            document.getElementById("ten_user").innerText = user;
        }

        function dangXuat() {
            localStorage.removeItem("dangnhap_hien_tai");
            window.location.href = "trangchu.html";
        }

        let expenses = {};

        function openForm() {
            let date = document.getElementById("datePicker").value;
            if (!date) {
                alert("Vui lòng chọn ngày!");
                return;
            }
            document.getElementById("overlay").style.display = "flex";
        }

        function closeForm() {
            document.getElementById("overlay").style.display = "none";
        }

        function addExpense() {
            let date = document.getElementById("datePicker").value;
            let sp = document.getElementById("sp").value;
            let gia = parseFloat(document.getElementById("gia").value);
            let sl = parseInt(document.getElementById("soluong").value);

            if (!sp || !gia || !sl) {
                alert("Điền đủ thông tin!");
                return;
            }

            if (!expenses[date]) expenses[date] = [];

            expenses[date].push({ sp, gia, sl, total: gia * sl });

            closeForm();
            display(date);
        }

        function display(date) {
            let tbody = document.getElementById("tableBody");
            tbody.innerHTML = "";
            let sum = 0;

            if (expenses[date]) {
                expenses[date].forEach(item => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.sp}</td>
                            <td>${item.gia}</td>
                            <td>${item.sl}</td>
                            <td>${item.total}</td>
                        </tr>`;
                    sum += item.total;
                });
            }
            document.getElementById("tong").innerText = sum;
        }

        document.getElementById("datePicker").addEventListener("change", function(){
            display(this.value);
        });

    </script>
</body>
</html>